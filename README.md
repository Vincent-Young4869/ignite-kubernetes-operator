# Ignite Kubernetes Operator Repository

A Kubernetes operator for [Apache Ignite](https://ignite.apache.org/) (or [GridGain Ignite](https://www.gridgain.com/)),
implemented in Java. It allows users to manage Ignite applications and their lifecycle through native k8s tooling like
kubectl.

(The implementation is based on [Java Operator SDK](https://javaoperatorsdk.io/docs/) (JOSDK) and refers to
the [flink-kubernetes-operator](https://github.com/apache/flink-kubernetes-operator) project)

## Modules Summary

Currently, the repo includes 3 modules:

- **ignite operator**
    - the implementation of k8s operator for apache ignite, based on JOSDK.
- **ignite kubernetes operator api**
    - defines ignite CRD and its related data models to allow users to manage ignite resource programmatically.
- **examples**
    - code examples to deploy ignite resources through fabric8 api.
    - sample manifests (`resources/cr/ignite-cluster.yaml`) to deploy ignite resource through `kubectl`.
    - sample manifests (`resources/operator`) to deploy ignite operator.
    - sample manifests (`resources/samples`) to deploy an ignite cluster without ignite operator (this is currently the
      common way to deploy ignite cluster, refer
      to [ignite official doc](https://ignite.apache.org/docs/2.16.0/installation/kubernetes/gke-deployment) for more
      details).
- **e2e-tests**
    - end-to-end behavioural tests (only happy path) to automate the tests for creating and deleting ignite resources.

## Features Summary

- Deploy ignite cluster as a `StatefulSet`, along with:
    - RBAC related resource (`role`, `role binding`, `service account`)
    - `Service` with configurable type
    - `ConfigMap` for ignite configurations
    - `Persistence` volume (optional)
- Upgrade and delete the ignite resource
- Status update and lifecycle management for ignite cluster

## Local Setup

To try the operator locally, there are several prerequisites need to be installed:

- docker
- minikube and kubectl
- colima or docker desktop

The general procedure to run the operator is as follows:

1. start minikube
2. create CRD for ignite resource. 
   (the CRD manifest is automatically generated by building the module, under the path:
   `ignite-kubernetes-operator-api/build/classes/java/main/META-INF/fabric8/<crd_name>.xxx.xxx.yml`)
3. create the namespace where the ignite resource will be deployed
4. run the operator from IDE, or in a docker container if operator image is built/already exists 
5. define the custom resource manifest for ignite resource
6. create/update/get/delete the custom resource. There are 2 ways to operate it, through kubectl
   and fabric8 api. Please refer to **examples** module for more details